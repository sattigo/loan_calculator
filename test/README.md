# Тесты для loan_calculator

Этот каталог содержит юнит-тесты для пакета `loan_calculator`.

## Структура тестов

### component/loan_calculator/
Тесты для основного компонента кредитного калькулятора:

- `bloc_test.dart` - Тесты для `LoanCalculatorBloc`
- `state_extension_test.dart` - Тесты для расширения состояния `LoanCalculatorStateX`

## Покрытие тестами

### LoanCalculatorBloc

Тесты покрывают следующие сценарии:

1. **Инициализация**
   - Проверка начального состояния блока

2. **Загрузка информации о кредите (`loadLoanInfo`)**
   - Успешная загрузка лимитов и настроек
   - Загрузка с существующими данными
   - Обработка ошибок загрузки

3. **Обработка события продолжения (`proceed`)**
   - Эмиссия соответствующих действий с данными калькулятора

4. **Изменение суммы кредита (`currencyAmountChanged`)**
   - Пересчет ежемесячных платежей
   - Обработка суммы ниже минимального лимита
   - Обработка суммы выше максимального лимита
   - Обработка ошибок расчета

5. **Изменение дохода (`incomeAmountChanged`)**
   - Обновление состояния с новой суммой дохода

6. **Изменение срока кредита**
   - Установка временного срока (`durationChangeStarted`)
   - Пересчет при завершении изменения срока (`durationChangeEnded`)

7. **Загрузка условий (`loadConditions`)**
   - Загрузка документов
   - Обработка ошибок загрузки

8. **Взаимодействие с документами (`onDocumentTap`)**
   - Обработка нажатия на публичные документы
   - Игнорирование приватных документов

9. **Переключение состояний**
   - Изменение состояния загрузки
   - Переключение расширения ежемесячного платежа

### LoanCalculatorStateX

Тесты покрывают логику расширения состояния:

1. **`canProceed`** - Проверка возможности продолжения
2. **`canExpandMonthlyPayment`** - Проверка возможности расширения информации о платеже
3. **`isIncomeFeatureEnabled`** - Проверка включения функции дохода
4. **`isIncomeFeatureValid`** - Проверка валидности дохода

## Моки

Используются следующие моки:

- `LoanCalculatorRepositoryMock` - Мок репозитория
- `LoanCalculatorLocalizationMock` - Мок локализации
- `LoanApplicationFormMock` - Мок формы заявки
- `MonthlyPaymentMock` - Мок ежемесячного платежа
- `DocumentsMock` - Мок документов
- И другие моки для Freezed-классов

## Запуск тестов

```bash
# Запуск всех тестов
flutter test

# Запуск конкретного теста
flutter test test/component/loan_calculator/bloc_test.dart

# Запуск с подробным выводом
flutter test --verbose

# Запуск с покрытием
flutter test --coverage
```

## Примечания

- Все тесты используют `baseBlocTest` из `flutter_framework` для тестирования блоков
- Используется `mocktail` для создания моков
- Тесты проверяют как состояния, так и действия блока
- Включена проверка вызовов методов репозитория через `verify`
- Использованы временные задержки для тестирования debounce логики
